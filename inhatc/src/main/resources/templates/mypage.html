<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Page</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background-color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        color: #0f1419;
        line-height: 1.5;
        min-height: 100vh;
        padding: 0;
        margin: 0;
      }

      .wrapper {
        max-width: 600px;
        margin: 0 auto;
        background-color: #ffffff;
        min-height: 100vh;
        border-left: 1px solid #eff3f4;
        border-right: 1px solid #eff3f4;
      }

      .container {
        padding: 12px 16px;
      }

      /* X ìŠ¤íƒ€ì¼ ë„¤ë¹„ê²Œì´ì…˜ ë°” */
      .navbar {
        position: sticky;
        top: 0;
        background-color: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid #eff3f4;
        padding: 16px 20px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        z-index: 100;
        min-height: 64px;
        gap: 20px;
      }

      .navbar img {
        cursor: pointer;
        padding: 10px;
        border-radius: 50%;
        transition: background-color 0.2s;
        object-fit: contain;
      }

      .navbar img:hover {
        background-color: #f7f9f9;
      }

      /* home.png: 256x256 (1:1) - 30% ì¦ê°€ */
      .navbar img[src="/images/home.png"] {
        width: 52px;
        height: 52px;
      }

      /* user.png: 700x594 (ì•½ 1.18:1) - 30% ì¦ê°€ */
      .navbar img[src="/images/user.png"] {
        width: 61px;
        height: 52px;
      }

      /* Message.png: 512x512 (1:1) - 30% ì¦ê°€ */
      .navbar img[src="/Message.png"] {
        width: 52px;
        height: 52px;
      }

      /* alram.png: 700x590 (ì•½ 1.19:1) - 30% ì¦ê°€ */
      .navbar img[src="/images/alram.png"] {
        width: 61px;
        height: 52px;
      }

      /* logout.png - 30% ì¦ê°€ */
      .navbar img[src="/images/logout.png"] {
        width: 52px;
        height: 52px;
      }

      .profile-img-container {
        text-align: center;
        padding: 24px 16px;
        border-bottom: 1px solid #eff3f4;
      }

      .profile-img {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 50%;
        display: block;
        margin: 0 auto 16px;
      }

      .profile-img-container > div {
        font-size: 20px;
        font-weight: 700;
        color: #0f1419;
        margin-bottom: 4px;
      }

      .profile-img-container > div:last-child {
        font-size: 15px;
        color: #536471;
        font-weight: 400;
      }

      #uploadFormContainer {
        padding: 16px;
        border-bottom: 1px solid #eff3f4;
      }

      #uploadFormContainer form {
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: center;
      }

      #uploadFormContainer label {
        font-size: 15px;
        color: #0f1419;
        font-weight: 500;
      }

      #uploadFormContainer input[type="file"] {
        font-size: 14px;
        color: #536471;
        padding: 8px;
      }

      #uploadFormContainer button {
        background-color: #0f1419;
        color: #ffffff;
        border: none;
        border-radius: 24px;
        padding: 10px 24px;
        font-size: 15px;
        font-weight: 700;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      #uploadFormContainer button:hover {
        background-color: #272c30;
      }

      #post-list {
        padding: 16px;
      }

      #post-list h3 {
        font-size: 20px;
        font-weight: 700;
        color: #0f1419;
        margin-bottom: 16px;
      }

      .card {
        padding: 16px;
        border-bottom: 1px solid #eff3f4;
        position: relative;
        transition: background-color 0.2s;
      }

      .card:hover {
        background-color: #f7f9f9;
      }

      .card:last-child {
        border-bottom: none;
      }

      .card-header {
        font-size: 15px;
        font-weight: 700;
        color: #0f1419;
        margin-bottom: 8px;
      }

      .card-body {
        font-size: 15px;
        color: #0f1419;
        margin: 8px 0;
        word-wrap: break-word;
      }

      .post-date {
        font-size: 13px;
        color: #536471;
        margin-top: 8px;
      }

      .content-img {
        width: 100%;
        max-width: 100%;
        border-radius: 16px;
        margin-top: 12px;
        object-fit: cover;
        max-height: 400px;
      }

      .delete-button {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #536471;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
        font-size: 18px;
        font-weight: 700;
        background-color: transparent;
        border: none;
      }

      .delete-button:hover {
        background-color: #f4212e;
        color: #ffffff;
      }

      #debugInfo {
        background-color: #f7f9f9;
        padding: 12px 16px;
        margin: 16px;
        border: 1px solid #eff3f4;
        border-radius: 8px;
        font-size: 13px;
        color: #536471;
      }

      #debugInfo button {
        background-color: #0f1419;
        color: #ffffff;
        border: none;
        border-radius: 20px;
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        margin-top: 8px;
      }

      button[onclick*="debugInfo"] {
        background-color: #0f1419;
        color: #ffffff;
        border: none;
        border-radius: 20px;
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        margin: 16px;
      }

      /* ë°˜ì‘í˜• ë””ìì¸ */
      @media (max-width: 768px) {
        .wrapper {
          max-width: 100%;
          border-left: none;
          border-right: none;
        }
      }
    </style>
  </head>

  <body>
    <div class="wrapper">
      <!-- Navigation Bar -->
      <div class="navbar">
        <!-- í™ˆ -->
        <img
          src="/images/home.png"
          alt="home"
          onclick="location.href='/main';"
        />

        <!-- ì‚¬ìš©ì ì´ë¯¸ì§€ í´ë¦­: session ê¸°ë°˜ìœ¼ë¡œ MyPageë¡œ ì´ë™ -->
        <img
          src="/images/user.png"
          alt="User"
          onclick="location.href='/member/mypage';"
        />

        <!-- ë©”ì‹œì§€: Message.png -->
        <img
          src="/Message.png"
          alt="Message"
          onclick="location.href='/chat/message';"
        />

        <!-- ì•ŒëŒ / ê²Œì‹œë¬¼ í™•ì¸ -->
        <img
          src="/images/alram.png"
          alt="Alarm"
          onclick="location.href='/posts/check';"
        />

        <!-- ë¡œê·¸ì•„ì›ƒ -->
        <img
          src="/images/logout.png"
          alt="Logout"
          onclick="document.getElementById('logout').submit();"
        />
        <form id="logout" action="/api/members/logout" method="post"></form>
      </div>

      <div class="container">
        <!-- ë””ë²„ê¹… ì •ë³´ í‘œì‹œ (ê°œë°œ ì¤‘ì—ë§Œ í‘œì‹œ) -->
        <div id="debugInfo" style="background-color: #f0f0f0; padding: 10px; margin: 10px 0; border: 1px solid #ccc; font-size: 12px; display: none;">
          <strong>ğŸ” ë””ë²„ê¹… ì •ë³´:</strong><br/>
          ì„¸ì…˜ loginEmail: <span id="debugLoginEmail" th:text="${loginEmail}">-</span><br/>
          ì¡°íšŒ viewedEmail: <span id="debugViewedEmail" th:text="${viewedEmail != null ? viewedEmail : (viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail)}">-</span><br/>
          isOwner ê°’: <span id="debugIsOwner" th:text="${isOwner}">-</span><br/>
          isOwner íƒ€ì…: <span id="debugIsOwnerType">-</span><br/>
          isOwner != null: <span id="debugIsOwnerNotNull">-</span><br/>
          isOwner == true: <span id="debugIsOwnerTrue">-</span><br/>
          <button onclick="document.getElementById('debugInfo').style.display='none'">ìˆ¨ê¸°ê¸°</button>
        </div>
        <button onclick="document.getElementById('debugInfo').style.display='block'" style="margin-bottom: 10px; padding: 5px 10px; font-size: 12px;">ë””ë²„ê¹… ì •ë³´ ë³´ê¸°</button>
        
        <div class="profile-img-container">
          <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ í‘œì‹œ (viewedMember ë˜ëŠ” loggedInMember ì‚¬ìš©) -->
          <img
            id="profileImage"
            class="profile-img"
            th:src="@{/member/Userimgsource/{email}(email=${viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail})}"
            alt="Profile Image"
            onerror="this.src='/images/default-profile.png'"
          />
          <div>
            <th:block th:if="${isOwner != null and isOwner == true}">
              <span>welcome! </span>
            </th:block>
            <span th:text="${viewedMember != null ? viewedMember.memberName : loggedInMember.memberName}"></span>
            <th:block th:if="${isOwner == null or isOwner == false}">
              <span>ë‹˜ì˜ í”„ë¡œí•„</span>
            </th:block>
          </div>
          <div th:if="${viewedMember != null || loggedInMember != null}">
            <span th:text="${viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail}"></span>
          </div>
          
          <!-- ë©”ì‹œì§€ ë²„íŠ¼ (ë‹¤ë¥¸ ìœ ì € í˜ì´ì§€ì¼ ë•Œë§Œ í‘œì‹œ) -->
          <div th:if="${isOwner == null or isOwner == false}" style="margin-top: 16px;">
            <a 
              th:href="@{/chat/message(receiverEmail=${viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail})}"
              style="background-color: #1d9bf0; color: #ffffff; border: none; border-radius: 24px; padding: 10px 24px; font-size: 15px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; margin: 0 auto; text-decoration: none;">
              <img src="/Message.png" alt="Message" style="width: 20px; height: 20px; object-fit: contain;">
              ë©”ì‹œì§€ ë³´ë‚´ê¸°
            </a>
          </div>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ í¼ (ë³¸ì¸ í˜ì´ì§€ì¼ ë•Œë§Œ í‘œì‹œ) -->
        <div id="uploadFormContainer" th:if="${isOwner != null and isOwner == true}">
          <form
            id="profileUploadForm"
            th:action="@{/member/upload}"
            method="post"
            enctype="multipart/form-data"
          >
            <label for="file">í”„ë¡œí•„ ì‚¬ì§„ ë³€ê²½</label>
            <input type="file" id="file" name="file" required />

            <!-- ë¡œê·¸ì¸ ì´ë©”ì¼ì„ í•¨ê»˜ ì „ì†¡ -->
            <input type="hidden" name="loginEmail" th:value="${loginEmail}" />

            <button type="submit">Upload</button>
          </form>
        </div>

        <!-- ì‚¬ìš©ì í¬ìŠ¤íŠ¸ í‘œì‹œ ì˜ì—­ -->
        <div id="post-list">
          <h3>ì‘ì„±í•œ ê²Œì‹œê¸€</h3>
          <div th:if="${userpost != null && !userpost.isEmpty() || userPosts != null && !userPosts.isEmpty()}">
            <div th:each="post : ${userpost != null ? userpost : userPosts}" class="card">
              <!-- ê²Œì‹œê¸€ ì‚­ì œ ë²„íŠ¼ (ë³¸ì¸ í˜ì´ì§€ì¼ ë•Œë§Œ í‘œì‹œ) -->
              <button
                th:if="${isOwner != null and isOwner == true}"
                class="delete-button"
                th:attr="data-post-id=${post.id}"
                onclick="deletePost(this)"
                >Ã—</button>
              <div class="card-header" th:text="${post.writer}">No Title</div>
              <div class="card-body" th:text="${post.content}">No Content</div>
              <div class="post-date">
                Created: <span th:text="${post.createdDate}">No Date</span>
                <span th:if="${post.modifiedDate != null}">
                  | Modified: <span th:text="${post.modifiedDate}">No Date</span>
                </span>
              </div>
              <div th:if="${post.imgsource != null && !post.imgsource.isEmpty()}">
                <img
                  class="content-img"
                  th:src="@{/api/image/{id}(id=${post.id})}"
                  alt="Post Image"
                  onerror="this.style.display='none'"
                />
              </div>
            </div>
          </div>
          <div th:if="${(userpost == null || userpost.isEmpty()) && (userPosts == null || userPosts.isEmpty())}" 
               style="text-align: center; padding: 60px 20px; color: #536471; font-size: 15px;">
            ì‘ì„±í•œ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </div>

    <script>
      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë””ë²„ê¹… ì •ë³´ ì¶œë ¥ ë° ë³´ì•ˆ ê²€ì¦
      window.onload = function() {
        const isOwner = /*[[${isOwner}]]*/ null;
        const loginEmail = /*[[${loginEmail}]]*/ null;
        const viewedEmail = /*[[${viewedEmail != null ? viewedEmail : (viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail)}]]*/ null;
        
        console.log("========================================");
        console.log("[DEBUG] mypage.html ë¡œë“œë¨");
        console.log("  - ì„¸ì…˜ loginEmail:", loginEmail);
        console.log("  - ì¡°íšŒ viewedEmail:", viewedEmail);
        console.log("  - isOwner ê°’:", isOwner);
        console.log("  - isOwner íƒ€ì…:", typeof isOwner);
        console.log("  - isOwner != null:", isOwner != null);
        console.log("  - isOwner == true:", isOwner == true);
        console.log("  - isOwner === true:", isOwner === true);
        console.log("  - ë‘ ì´ë©”ì¼ ë¹„êµ:", loginEmail === viewedEmail);
        console.log("========================================");
        
        // ë””ë²„ê¹… ì •ë³´ ì—…ë°ì´íŠ¸
        if (document.getElementById('debugIsOwnerType')) {
          document.getElementById('debugIsOwnerType').textContent = typeof isOwner;
        }
        if (document.getElementById('debugIsOwnerNotNull')) {
          document.getElementById('debugIsOwnerNotNull').textContent = (isOwner != null);
        }
        if (document.getElementById('debugIsOwnerTrue')) {
          document.getElementById('debugIsOwnerTrue').textContent = (isOwner == true);
        }
        
        // ë³´ì•ˆ ê²€ì¦: isOwnerê°€ falseì´ë©´ í”„ë¡œí•„ ì—…ë¡œë“œ í¼ê³¼ ì‚­ì œ ë²„íŠ¼ ê°•ì œë¡œ ìˆ¨ê¹€
        if (isOwner !== true) {
          console.log("ğŸ”’ [ë³´ì•ˆ] isOwnerê°€ falseì´ë¯€ë¡œ í”„ë¡œí•„ ì—…ë¡œë“œ í¼ê³¼ ì‚­ì œ ë²„íŠ¼ì„ ìˆ¨ê¹ë‹ˆë‹¤.");
          console.log("  - isOwner ê°’:", isOwner);
          console.log("  - isOwner íƒ€ì…:", typeof isOwner);
          console.log("  - isOwner !== true:", isOwner !== true);
          
          // í”„ë¡œí•„ ì—…ë¡œë“œ í¼ ìˆ¨ê¸°ê¸° (ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ì‹œë„)
          const uploadFormContainer = document.getElementById('uploadFormContainer');
          if (uploadFormContainer) {
            uploadFormContainer.style.display = 'none';
            console.log("âœ… í”„ë¡œí•„ ì—…ë¡œë“œ í¼ ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€ ì™„ë£Œ");
          }
          
          const uploadForm = document.getElementById('profileUploadForm');
          if (uploadForm) {
            uploadForm.style.display = 'none';
            console.log("âœ… í”„ë¡œí•„ ì—…ë¡œë“œ í¼ ìˆ¨ê¹€ ì™„ë£Œ");
          }
          
          // ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œë„ ì°¾ê¸°
          const uploadForms = document.querySelectorAll('form[action*="/member/upload"]');
          uploadForms.forEach(function(form) {
            form.style.display = 'none';
            if (form.parentElement) {
              form.parentElement.style.display = 'none';
            }
            console.log("âœ… ì¶”ê°€ í”„ë¡œí•„ ì—…ë¡œë“œ í¼ ìˆ¨ê¹€ ì™„ë£Œ");
          });
          
          // ëª¨ë“  ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
          const deleteButtons = document.querySelectorAll('.delete-button');
          console.log("  - ë°œê²¬ëœ ì‚­ì œ ë²„íŠ¼ ê°œìˆ˜:", deleteButtons.length);
          deleteButtons.forEach(function(btn) {
            btn.style.display = 'none';
            btn.style.visibility = 'hidden';
            btn.setAttribute('hidden', 'true');
            console.log("âœ… ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€ ì™„ë£Œ:", btn);
          });
          
          // th:blockìœ¼ë¡œ ê°ì‹¸ì§„ ìš”ì†Œë“¤ë„ ìˆ¨ê¸°ê¸°
          const thBlocks = document.querySelectorAll('th\\:block, [th\\:if]');
          thBlocks.forEach(function(block) {
            const text = block.textContent || '';
            if (text.includes('Upload') || text.includes('X') || text.includes('í”„ë¡œí•„')) {
              block.style.display = 'none';
              console.log("âœ… th:block ìˆ¨ê¹€ ì™„ë£Œ:", block);
            }
          });
          
          console.log("ğŸ”’ [ë³´ì•ˆ] ëª¨ë“  ë³´ì•ˆ ì¡°ì¹˜ ì™„ë£Œ");
        } else {
          console.log("âœ… isOwnerê°€ trueì´ë¯€ë¡œ ëª¨ë“  ê¸°ëŠ¥ì´ í™œì„±í™”ë©ë‹ˆë‹¤.");
          
          // isOwnerê°€ trueì¼ ë•ŒëŠ” ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
          const deleteButtons = document.querySelectorAll('.delete-button');
          deleteButtons.forEach(function(btn) {
            btn.style.display = '';
            btn.style.visibility = 'visible';
            btn.removeAttribute('hidden');
          });
        }
        
        // ì¶”ê°€ ë³´ì•ˆ: MutationObserverë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë˜ëŠ” ìš”ì†Œë„ ê°ì‹œ
        if (isOwner !== true) {
          const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              mutation.addedNodes.forEach(function(node) {
                if (node.nodeType === 1) { // Element node
                  // ì¶”ê°€ëœ í¼ ìˆ¨ê¸°ê¸°
                  if (node.tagName === 'FORM' && (node.action && node.action.includes('/member/upload'))) {
                    node.style.display = 'none';
                    if (node.parentElement) {
                      node.parentElement.style.display = 'none';
                    }
                    console.log("ğŸ”’ [ë³´ì•ˆ] ë™ì ìœ¼ë¡œ ì¶”ê°€ëœ í”„ë¡œí•„ ì—…ë¡œë“œ í¼ ìˆ¨ê¹€");
                  }
                  // ì¶”ê°€ëœ ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
                  if (node.classList && node.classList.contains('delete-button')) {
                    node.style.display = 'none';
                    console.log("ğŸ”’ [ë³´ì•ˆ] ë™ì ìœ¼ë¡œ ì¶”ê°€ëœ ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€");
                  }
                  // ìì‹ ìš”ì†Œë“¤ë„ í™•ì¸
                  if (node.querySelectorAll) {
                    const forms = node.querySelectorAll('form[action*="/member/upload"]');
                    forms.forEach(function(form) {
                      form.style.display = 'none';
                      if (form.parentElement) {
                        form.parentElement.style.display = 'none';
                      }
                      console.log("ğŸ”’ [ë³´ì•ˆ] ìì‹ ìš”ì†Œì˜ í”„ë¡œí•„ ì—…ë¡œë“œ í¼ ìˆ¨ê¹€");
                    });
                    const deleteBtns = node.querySelectorAll('.delete-button');
                    deleteBtns.forEach(function(btn) {
                      btn.style.display = 'none';
                      console.log("ğŸ”’ [ë³´ì•ˆ] ìì‹ ìš”ì†Œì˜ ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€");
                    });
                  }
                }
              });
            });
          });
          
          observer.observe(document.body, {
            childList: true,
            subtree: true
          });
          
          console.log("âœ… MutationObserver ì„¤ì • ì™„ë£Œ - ë™ì  ìš”ì†Œ ê°ì‹œ ì‹œì‘");
        }
      };
      
      function deletePost(element) {
        const isOwner = /*[[${isOwner}]]*/ null;
        const loginEmail = /*[[${loginEmail}]]*/ null;
        const viewedEmail = /*[[${viewedEmail != null ? viewedEmail : (viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail)}]]*/ null;
        
        console.log("[DEBUG] deletePost í˜¸ì¶œ");
        console.log("  - isOwner:", isOwner);
        console.log("  - loginEmail:", loginEmail);
        console.log("  - viewedEmail:", viewedEmail);
        
        // ë³´ì•ˆ ê²€ì¦: isOwnerê°€ trueê°€ ì•„ë‹ˆë©´ ì‚­ì œ ì°¨ë‹¨
        if (isOwner !== true) {
          alert("ë³¸ì¸ì˜ ê²Œì‹œë¬¼ë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          console.error("âŒ [ë³´ì•ˆ] ì‚­ì œ ì‹œë„ ì°¨ë‹¨: isOwnerê°€ trueê°€ ì•„ë‹™ë‹ˆë‹¤. isOwner=" + isOwner);
          return;
        }
        
        const postId = element.getAttribute("data-post-id");
        if (confirm("ê²Œì‹œë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          fetch(`/member/delete?id=${encodeURIComponent(postId)}`, {
            method: "POST",
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("ê²Œì‹œë¬¼ ì‚­ì œ ì‹¤íŒ¨");
              }
              return response.text();
            })
            .then(() => {
              alert("ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
              element.parentElement.remove(); // ì‚­ì œëœ í¬ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
            })
            .catch((error) => console.error("Error:", error));
        }
      }
      
      // í”„ë¡œí•„ ì—…ë¡œë“œ í¼ ì œì¶œ ì‹œ ë³´ì•ˆ ê²€ì¦ (ì¦‰ì‹œ ì‹¤í–‰ ë° DOMContentLoaded)
      (function() {
        const isOwner = /*[[${isOwner}]]*/ null;
        
        function attachSecurityCheck() {
          const uploadForms = document.querySelectorAll('form[action*="/member/upload"], form#profileUploadForm');
          uploadForms.forEach(function(uploadForm) {
            // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
            const newForm = uploadForm.cloneNode(true);
            uploadForm.parentNode.replaceChild(newForm, uploadForm);
            
            newForm.addEventListener('submit', function(event) {
              const currentIsOwner = /*[[${isOwner}]]*/ null;
              console.log("[ë³´ì•ˆ] í”„ë¡œí•„ ì—…ë¡œë“œ í¼ ì œì¶œ ì‹œë„, isOwner:", currentIsOwner);
              if (currentIsOwner !== true) {
                event.preventDefault();
                event.stopPropagation();
                event.stopImmediatePropagation();
                alert("ë³¸ì¸ì˜ í”„ë¡œí•„ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                console.error("âŒ [ë³´ì•ˆ] í”„ë¡œí•„ ì—…ë¡œë“œ ì°¨ë‹¨: isOwnerê°€ trueê°€ ì•„ë‹™ë‹ˆë‹¤. isOwner=" + currentIsOwner);
                return false;
              }
            }, true); // capture phaseì—ì„œ ì‹¤í–‰
          });
        }
        
        // ì¦‰ì‹œ ì‹¤í–‰
        attachSecurityCheck();
        
        // DOMContentLoadedì—ì„œë„ ì‹¤í–‰
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', attachSecurityCheck);
        } else {
          attachSecurityCheck();
        }
        
        // window.onloadì—ì„œë„ ì‹¤í–‰
        window.addEventListener('load', attachSecurityCheck);
      })();
    </script>
  </body>
</html>
