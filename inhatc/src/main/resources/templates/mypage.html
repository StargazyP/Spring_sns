<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Page</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background-color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        color: #0f1419;
        line-height: 1.5;
        min-height: 100vh;
        padding: 0;
        margin: 0;
      }

      .wrapper {
        max-width: 600px;
        margin: 0 auto;
        background-color: #ffffff;
        min-height: 100vh;
        border-left: 1px solid #eff3f4;
        border-right: 1px solid #eff3f4;
      }

      .container {
        padding: 12px 16px;
      }

      /* X 스타일 네비게이션 바 */
      .navbar {
        position: sticky;
        top: 0;
        background-color: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid #eff3f4;
        padding: 16px 20px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        z-index: 100;
        min-height: 64px;
        gap: 20px;
      }

      .navbar img {
        cursor: pointer;
        padding: 10px;
        border-radius: 50%;
        transition: background-color 0.2s;
        object-fit: contain;
      }

      .navbar img:hover {
        background-color: #f7f9f9;
      }

      /* home.png: 256x256 (1:1) - 30% 증가 */
      .navbar img[src="/images/home.png"] {
        width: 52px;
        height: 52px;
      }

      /* user.png: 700x594 (약 1.18:1) - 30% 증가 */
      .navbar img[src="/images/user.png"] {
        width: 61px;
        height: 52px;
      }

      /* Message.png: 512x512 (1:1) - 30% 증가 */
      .navbar img[src="/Message.png"] {
        width: 52px;
        height: 52px;
      }

      /* alram.png: 700x590 (약 1.19:1) - 30% 증가 */
      .navbar img[src="/images/alram.png"] {
        width: 61px;
        height: 52px;
      }

      /* logout.png - 30% 증가 */
      .navbar img[src="/images/logout.png"] {
        width: 52px;
        height: 52px;
      }

      .profile-img-container {
        text-align: center;
        padding: 24px 16px;
        border-bottom: 1px solid #eff3f4;
      }

      .profile-img {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 50%;
        display: block;
        margin: 0 auto 16px;
      }

      .profile-img-container > div {
        font-size: 20px;
        font-weight: 700;
        color: #0f1419;
        margin-bottom: 4px;
      }

      .profile-img-container > div:last-child {
        font-size: 15px;
        color: #536471;
        font-weight: 400;
      }

      #uploadFormContainer {
        padding: 16px;
        border-bottom: 1px solid #eff3f4;
      }

      #uploadFormContainer form {
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: center;
      }

      #profileFileInput {
        display: none; /* 파일 입력을 숨김 */
      }

      /* 이미지 업로드 버튼 스타일 (main.html과 동일) */
      .profile-upload-button {
        padding: 8px 12px;
        background-color: #f7f9f9;
        color: #0f1419;
        border: 1px solid #eff3f4;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .profile-upload-button:hover {
        background-color: #eff3f4;
      }

      #uploadFormContainer button[type="submit"] {
        background-color: #0f1419;
        color: #ffffff;
        border: none;
        border-radius: 24px;
        padding: 10px 24px;
        font-size: 15px;
        font-weight: 700;
        cursor: pointer;
        transition: background-color 0.2s;
        margin-top: 8px;
      }

      #uploadFormContainer button[type="submit"]:hover {
        background-color: #272c30;
      }

      #post-list {
        padding: 16px;
      }

      #post-list h3 {
        font-size: 20px;
        font-weight: 700;
        color: #0f1419;
        margin-bottom: 16px;
      }

      .card {
        padding: 16px;
        border-bottom: 1px solid #eff3f4;
        position: relative;
        transition: background-color 0.2s;
      }

      .card:hover {
        background-color: #f7f9f9;
      }

      .card:last-child {
        border-bottom: none;
      }

      .card-header {
        font-size: 15px;
        font-weight: 700;
        color: #0f1419;
        margin-bottom: 8px;
      }

      .card-body {
        font-size: 15px;
        color: #0f1419;
        margin: 8px 0;
        word-wrap: break-word;
      }

      .post-date {
        font-size: 13px;
        color: #536471;
        margin-top: 8px;
      }

      .content-img {
        width: 100%;
        max-width: 100%;
        border-radius: 16px;
        margin-top: 12px;
        object-fit: cover;
        max-height: 400px;
      }

      .delete-button {
        position: absolute;
        top: 12px;
        right: 12px;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #536471;
        cursor: pointer;
        transition: background-color 0.2s, color 0.2s;
        font-size: 18px;
        font-weight: 700;
        background-color: transparent;
        border: none;
      }

      .delete-button:hover {
        background-color: #f4212e;
        color: #ffffff;
      }

      #debugInfo {
        background-color: #f7f9f9;
        padding: 12px 16px;
        margin: 16px;
        border: 1px solid #eff3f4;
        border-radius: 8px;
        font-size: 13px;
        color: #536471;
      }

      #debugInfo button {
        background-color: #0f1419;
        color: #ffffff;
        border: none;
        border-radius: 20px;
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        margin-top: 8px;
      }

      button[onclick*="debugInfo"] {
        background-color: #0f1419;
        color: #ffffff;
        border: none;
        border-radius: 20px;
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        margin: 16px;
      }

      /* 팔로우 관련 스타일 */
      .follow-stat {
        transition: opacity 0.2s;
      }

      .follow-stat:hover {
        opacity: 0.7;
      }

      .follow-btn {
        background-color: #0f1419 !important;
        color: #ffffff !important;
      }

      .follow-btn.following {
        background-color: #ffffff !important;
        color: #0f1419 !important;
        border: 1px solid #eff3f4 !important;
      }

      .follow-btn.following:hover {
        background-color: #f4212e !important;
        color: #ffffff !important;
        border-color: #f4212e !important;
      }

      .follow-btn.following:hover::after {
        content: '언팔로우';
      }

      .follow-btn.following::after {
        content: '팔로잉';
      }

      /* 모달 스타일 */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        overflow: auto;
      }

      .modal-content {
        background-color: #ffffff;
        margin: 5% auto;
        padding: 0;
        border-radius: 16px;
        width: 90%;
        max-width: 400px;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
      }

      .modal-header {
        padding: 16px 20px;
        border-bottom: 1px solid #eff3f4;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h2 {
        font-size: 20px;
        font-weight: 700;
        color: #0f1419;
        margin: 0;
      }

      .close {
        color: #536471;
        font-size: 28px;
        font-weight: 300;
        cursor: pointer;
        line-height: 1;
      }

      .close:hover {
        color: #0f1419;
      }

      .modal-body {
        padding: 0;
        overflow-y: auto;
        flex: 1;
      }

      .follow-item {
        padding: 16px 20px;
        border-bottom: 1px solid #eff3f4;
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .follow-item:hover {
        background-color: #f7f9f9;
      }

      .follow-item:last-child {
        border-bottom: none;
      }

      .follow-item-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
      }

      .follow-item-info {
        flex: 1;
        min-width: 0;
      }

      .follow-item-name {
        font-size: 15px;
        font-weight: 700;
        color: #0f1419;
        margin-bottom: 2px;
      }

      .follow-item-email {
        font-size: 13px;
        color: #536471;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .follow-item-btn {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 700;
        cursor: pointer;
        border: none;
        transition: all 0.2s;
      }

      .follow-item-btn.follow {
        background-color: #0f1419;
        color: #ffffff;
      }

      .follow-item-btn.following {
        background-color: #ffffff;
        color: #0f1419;
        border: 1px solid #eff3f4;
      }

      .follow-item-btn.following:hover {
        background-color: #f4212e;
        color: #ffffff;
        border-color: #f4212e;
      }

      /* 반응형 디자인 */
      @media (max-width: 768px) {
        .wrapper {
          max-width: 100%;
          border-left: none;
          border-right: none;
        }
      }
    </style>
  </head>

  <body>
    <div class="wrapper">
      <!-- Navigation Bar -->
      <div class="navbar">
        <!-- 홈 -->
        <img
          src="/images/home.png"
          alt="home"
          onclick="location.href='/main';"
        />

        <!-- 사용자 이미지 클릭: session 기반으로 MyPage로 이동 -->
        <img
          src="/images/user.png"
          alt="User"
          onclick="location.href='/member/mypage';"
        />

        <!-- 메시지: Message.png -->
        <img
          src="/Message.png"
          alt="Message"
          onclick="location.href='/chat/message';"
        />

        <!-- 알람 / 게시물 확인: /posts/notifications/page -->
        <img
          src="/images/alram.png"
          alt="Alarm"
          onclick="location.href='/posts/notifications/page';"
        />

        <!-- 로그아웃 -->
        <img
          src="/images/logout.png"
          alt="Logout"
          onclick="document.getElementById('logout').submit();"
        />
        <form id="logout" action="/api/members/logout" method="post"></form>
      </div>

      <div class="container">
        <!-- 디버깅 정보 표시 (개발 중에만 표시) -->
        <!-- <div id="debugInfo" style="background-color: #f0f0f0; padding: 10px; margin: 10px 0; border: 1px solid #ccc; font-size: 12px; display: none;">
          <strong>디버깅 정보:</strong><br/>
          세션 loginEmail: <span id="debugLoginEmail" th:text="${loginEmail}">-</span><br/>
          조회 viewedEmail: <span id="debugViewedEmail" th:text="${viewedEmail != null ? viewedEmail : (viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail)}">-</span><br/>
          isOwner 값: <span id="debugIsOwner" th:text="${isOwner}">-</span><br/>
          isOwner 타입: <span id="debugIsOwnerType">-</span><br/>
          isOwner != null: <span id="debugIsOwnerNotNull">-</span><br/>
          isOwner == true: <span id="debugIsOwnerTrue">-</span><br/>
          <button onclick="document.getElementById('debugInfo').style.display='none'">숨기기</button>
        </div> -->
        <!-- <button onclick="document.getElementById('debugInfo').style.display='block'" style="margin-bottom: 10px; padding: 5px 10px; font-size: 12px;">디버깅 정보 보기</button> -->
        
        <div class="profile-img-container">
          <!-- 프로필 이미지 표시 (viewedMember 또는 loggedInMember 사용) -->
          <img
            id="profileImage"
            class="profile-img"
            th:src="@{/member/Userimgsource/{email}(email=${viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail})}"
            alt="Profile Image"
            onerror="this.src='/images/default-profile.png'"
          />
          <div>
            <span th:text="${viewedMember != null ? viewedMember.memberName : loggedInMember.memberName}"></span>
            <th:block th:if="${isOwner == null or !isOwner}">
              <span>님의 프로필</span>
            </th:block>
          </div>
          <div th:if="${viewedMember != null || loggedInMember != null}">
            <span 
              th:text="${viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail}"
              th:attr="data-viewed-email=${viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail}"
            ></span>
          </div>
          
          <!-- 팔로우 통계 및 버튼 -->
          <div style="margin-top: 16px; display: flex; justify-content: center; align-items: center; gap: 16px; flex-wrap: wrap;">
            <!-- 팔로워 수 -->
            <div style="cursor: pointer;" onclick="showFollowers()" class="follow-stat">
              <span style="font-weight: 700; color: #0f1419;" th:text="${followStats != null ? followStats.followerCount : 0}">0</span>
              <span style="color: #536471; margin-left: 4px;">팔로워</span>
            </div>
            <!-- 팔로잉 수 -->
            <div style="cursor: pointer;" onclick="showFollowing()" class="follow-stat">
              <span style="font-weight: 700; color: #0f1419;" th:text="${followStats != null ? followStats.followingCount : 0}">0</span>
              <span style="color: #536471; margin-left: 4px;">팔로잉</span>
            </div>
          </div>
          
          <!-- 팔로우 버튼 (다른 유저 페이지일 때만 표시) -->
          <div th:if="${isOwner == null or !isOwner}" style="margin-top: 16px; display: flex; gap: 8px; justify-content: center;">
            <button 
              id="followButton"
              th:class="${followStats != null && followStats.isFollowing ? 'follow-btn following' : 'follow-btn'}"
              th:text="${followStats != null && followStats.isFollowing ? '팔로잉' : '팔로우'}"
              onclick="toggleFollow()"
              style="background-color: #0f1419; color: #ffffff; border: none; border-radius: 24px; padding: 10px 24px; font-size: 15px; font-weight: 700; cursor: pointer; transition: background-color 0.2s;">
            </button>
            <a 
              th:href="@{/chat/message(receiverEmail=${viewedMember != null ? viewedMember.memberEmail : loggedInMember.memberEmail})}"
              style="background-color: #1d9bf0; color: #ffffff; border: none; border-radius: 24px; padding: 10px 24px; font-size: 15px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; text-decoration: none;">
              <img src="/Message.png" alt="Message" style="width: 20px; height: 20px; object-fit: contain;">
              메시지
            </a>
          </div>
        </div>

        <!-- 파일 업로드 폼 -->
        <div id="uploadFormContainer">
          <form
            id="profileUploadForm"
            th:action="@{/member/upload}"
            method="post"
            enctype="multipart/form-data"
          >
            <input type="file" id="profileFileInput" name="file" accept="image/*" required />
            <button type="button" class="profile-upload-button" onclick="document.getElementById('profileFileInput').click()">
              프로필 사진 변경
            </button>

            <!-- 로그인 이메일을 함께 전송 -->
            <input type="hidden" name="loginEmail" th:value="${loginEmail}" />

            <button type="submit">Upload</button>
          </form>
        </div>

        <!-- 사용자 포스트 표시 영역 -->
        <div id="post-list">
          <h3>작성한 게시글</h3>
          <div th:if="${userpost != null && !userpost.isEmpty() || userPosts != null && !userPosts.isEmpty()}">
            <div th:each="post : ${userpost != null ? userpost : userPosts}" 
                 class="card post-card" 
                 th:attr="data-post-id=${post.id}"
                 style="cursor: pointer;">
              <!-- 게시글 삭제 버튼 (본인 페이지일 때만 표시) -->
              <button
                th:if="${isOwner != null and isOwner == true}"
                class="delete-button"
                th:attr="data-post-id=${post.id}"
                onclick="event.stopPropagation(); deletePost(this);"
                >×</button>
              <div class="card-header" th:text="${post.writer}">No Title</div>
              <div class="card-body" th:text="${post.content}">No Content</div>
              <div class="post-date">
                Created: <span th:text="${post.createdDate}">No Date</span>
                <span th:if="${post.modifiedDate != null}">
                  | Modified: <span th:text="${post.modifiedDate}">No Date</span>
                </span>
              </div>
              <div th:if="${post.imgsource != null && !post.imgsource.isEmpty()}">
                <img
                  class="content-img"
                  th:src="@{/api/image/{id}(id=${post.id})}"
                  alt="Post Image"
                  onerror="this.style.display='none'"
                />
              </div>
            </div>
          </div>
          <div th:if="${(userpost == null || userpost.isEmpty()) && (userPosts == null || userPosts.isEmpty())}" 
               style="text-align: center; padding: 60px 20px; color: #536471; font-size: 15px;">
            작성한 게시글이 없습니다.
          </div>
        </div>
      </div>
    </div>

    <script>
      // 게시글 카드 클릭 이벤트 설정
      document.addEventListener('DOMContentLoaded', function() {
        const postCards = document.querySelectorAll('.post-card');
        postCards.forEach(function(card) {
          card.addEventListener('click', function(e) {
            // 삭제 버튼 클릭 시에는 이벤트 전파 방지
            if (e.target.classList.contains('delete-button') || e.target.closest('.delete-button')) {
              return;
            }
            const postId = card.getAttribute('data-post-id');
            if (postId) {
              window.location.href = `/posts/${postId}`;
            }
          });
        });
      });

      // 프로필 업로드 폼이 항상 표시되도록 보장
      window.onload = function() {
        // 프로필 업로드 폼이 항상 표시되도록 보장
        const uploadFormContainer = document.getElementById('uploadFormContainer');
        if (uploadFormContainer) {
          uploadFormContainer.style.display = 'block';
          uploadFormContainer.style.visibility = 'visible';
          uploadFormContainer.removeAttribute('hidden');
        }
        
        const uploadForm = document.getElementById('profileUploadForm');
        if (uploadForm) {
          uploadForm.style.display = 'block';
          uploadForm.style.visibility = 'visible';
          uploadForm.removeAttribute('hidden');
        }
      };
      
      function deletePost(element) {
        const postId = element.getAttribute("data-post-id");
        if (confirm("게시물을 삭제하시겠습니까?")) {
          fetch(`/member/delete?id=${encodeURIComponent(postId)}`, {
            method: "POST",
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("게시물 삭제 실패");
              }
              return response.text();
            })
            .then(() => {
              alert("게시물이 삭제되었습니다.");
              element.parentElement.remove(); // 삭제된 포스트 숨기기
            })
            .catch((error) => console.error("Error:", error));
        }
      }

      // 현재 조회 중인 사용자 이메일 가져오기
      function getViewedEmail() {
        const viewedEmailElement = document.querySelector('[data-viewed-email]');
        if (viewedEmailElement) {
          return viewedEmailElement.getAttribute('data-viewed-email');
        }
        // Thymeleaf 변수에서 가져오기
        const emailSpan = document.querySelector('span[th\\:text*="memberEmail"]');
        if (emailSpan) {
          return emailSpan.textContent.trim();
        }
        return null;
      }

      // 팔로우/언팔로우 토글
      async function toggleFollow() {
        const viewedEmail = getViewedEmail();
        if (!viewedEmail) {
          alert('사용자 정보를 찾을 수 없습니다.');
          return;
        }

        const followButton = document.getElementById('followButton');
        const isFollowing = followButton.classList.contains('following');
        const url = isFollowing 
          ? `/api/follow/${encodeURIComponent(viewedEmail)}/unfollow`
          : `/api/follow/${encodeURIComponent(viewedEmail)}`;

        try {
          const response = await fetch(url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText || '팔로우 처리 중 오류가 발생했습니다.');
          }

          // 버튼 상태 업데이트
          if (isFollowing) {
            followButton.classList.remove('following');
            followButton.textContent = '팔로우';
          } else {
            followButton.classList.add('following');
            followButton.textContent = '팔로잉';
          }

          // 통계 업데이트
          await updateFollowStats();
        } catch (error) {
          console.error('Error:', error);
          alert(error.message);
        }
      }

      // 팔로우 통계 업데이트
      async function updateFollowStats() {
        const viewedEmail = getViewedEmail();
        if (!viewedEmail) return;

        try {
          const response = await fetch(`/api/follow/${encodeURIComponent(viewedEmail)}/stats`);
          if (response.ok) {
            const stats = await response.json();
            // 통계 업데이트 (필요시)
            const followerCountElement = document.querySelector('.follow-stat:first-child span:first-child');
            const followingCountElement = document.querySelector('.follow-stat:last-child span:first-child');
            if (followerCountElement) {
              followerCountElement.textContent = stats.followerCount || 0;
            }
            if (followingCountElement) {
              followingCountElement.textContent = stats.followingCount || 0;
            }
          }
        } catch (error) {
          console.error('Error updating stats:', error);
        }
      }

      // 팔로워 목록 표시
      async function showFollowers() {
        const viewedEmail = getViewedEmail();
        if (!viewedEmail) return;

        try {
          const response = await fetch(`/api/follow/${encodeURIComponent(viewedEmail)}/followers`);
          if (!response.ok) {
            throw new Error('팔로워 목록을 불러올 수 없습니다.');
          }

          const followers = await response.json();
          showFollowModal('팔로워', followers, 'follower');
        } catch (error) {
          console.error('Error:', error);
          alert(error.message);
        }
      }

      // 팔로잉 목록 표시
      async function showFollowing() {
        const viewedEmail = getViewedEmail();
        if (!viewedEmail) return;

        try {
          const response = await fetch(`/api/follow/${encodeURIComponent(viewedEmail)}/following`);
          if (!response.ok) {
            throw new Error('팔로잉 목록을 불러올 수 없습니다.');
          }

          const following = await response.json();
          showFollowModal('팔로잉', following, 'following');
        } catch (error) {
          console.error('Error:', error);
          alert(error.message);
        }
      }

      // 팔로우 모달 표시
      function showFollowModal(title, items, type) {
        // 기존 모달이 있으면 제거
        const existingModal = document.getElementById('followModal');
        if (existingModal) {
          existingModal.remove();
        }

        // 모달 생성
        const modal = document.createElement('div');
        modal.id = 'followModal';
        modal.className = 'modal';
        modal.style.display = 'block';

        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';

        const modalHeader = document.createElement('div');
        modalHeader.className = 'modal-header';
        modalHeader.innerHTML = `
          <h2>${title}</h2>
          <span class="close" onclick="closeFollowModal()">&times;</span>
        `;

        const modalBody = document.createElement('div');
        modalBody.className = 'modal-body';

        if (items.length === 0) {
          modalBody.innerHTML = '<div style="padding: 40px; text-align: center; color: #536471;">목록이 비어있습니다.</div>';
        } else {
          items.forEach(item => {
            const email = type === 'follower' ? item.followerEmail : item.followingEmail;
            const name = type === 'follower' ? item.followerName : item.followingName;
            const profilePath = type === 'follower' ? item.followerProfilePicturePath : item.followingProfilePicturePath;
            const isFollowing = item.isFollowing;

            const followItem = document.createElement('div');
            followItem.className = 'follow-item';
            followItem.onclick = () => {
              window.location.href = `/member/profile/${encodeURIComponent(email)}`;
            };

            followItem.innerHTML = `
              <img 
                src="${profilePath || '/images/default-profile.png'}" 
                alt="${name}" 
                class="follow-item-img"
                onerror="this.src='/images/default-profile.png'"
              />
              <div class="follow-item-info">
                <div class="follow-item-name">${name}</div>
                <div class="follow-item-email">${email}</div>
              </div>
              <button 
                class="follow-item-btn ${isFollowing ? 'following' : 'follow'}"
                onclick="event.stopPropagation(); toggleFollowItem('${email}', this)"
                data-email="${email}"
              >
                ${isFollowing ? '팔로잉' : '팔로우'}
              </button>
            `;

            modalBody.appendChild(followItem);
          });
        }

        modalContent.appendChild(modalHeader);
        modalContent.appendChild(modalBody);
        modal.appendChild(modalContent);
        document.body.appendChild(modal);

        // 모달 외부 클릭 시 닫기
        modal.onclick = function(event) {
          if (event.target === modal) {
            closeFollowModal();
          }
        };
      }

      // 모달 닫기
      function closeFollowModal() {
        const modal = document.getElementById('followModal');
        if (modal) {
          modal.remove();
        }
      }

      // 팔로우 목록에서 개별 팔로우 토글
      async function toggleFollowItem(email, button) {
        const isFollowing = button.classList.contains('following');
        const url = isFollowing 
          ? `/api/follow/${encodeURIComponent(email)}/unfollow`
          : `/api/follow/${encodeURIComponent(email)}`;

        try {
          const response = await fetch(url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          });

          if (!response.ok) {
            throw new Error('팔로우 처리 중 오류가 발생했습니다.');
          }

          // 버튼 상태 업데이트
          if (isFollowing) {
            button.classList.remove('following');
            button.textContent = '팔로우';
          } else {
            button.classList.add('following');
            button.textContent = '팔로잉';
          }

          // 통계 업데이트
          await updateFollowStats();
        } catch (error) {
          console.error('Error:', error);
          alert(error.message);
        }
      }
      
    </script>
  </body>
</html>
