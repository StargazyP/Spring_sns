# SSH 서버에 MySQL 설치하기

# 1. 스크립트를 서버에 업로드
scp setup-mysql.sh ubuntu@jangdonggun.iptime.org:~/

# 2. 서버에 SSH 접속
ssh ubuntu@jangdonggun.iptime.org

# 3. 서버에서 스크립트 실행
chmod +x ~/setup-mysql.sh
sudo ~/setup-mysql.sh

# 또는 직접 명령어 실행:
sudo apt-get update
sudo apt-get install -y mysql-server
sudo systemctl start mysql
sudo systemctl enable mysql

# Root 비밀번호 설정
sudo mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'blackser7789';"
sudo mysql -e "FLUSH PRIVILEGES;"

# 데이터베이스 생성
sudo mysql -u root -pblackser7789 <<SQL
CREATE DATABASE IF NOT EXISTS member CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER IF NOT EXISTS 'spring_sns_user'@'localhost' IDENTIFIED BY 'blackser7789';
CREATE USER IF NOT EXISTS 'spring_sns_user'@'%' IDENTIFIED BY 'blackser7789';
GRANT ALL PRIVILEGES ON member.* TO 'spring_sns_user'@'localhost';
GRANT ALL PRIVILEGES ON member.* TO 'spring_sns_user'@'%';
FLUSH PRIVILEGES;
SQL

# 원격 접속 허용
sudo sed -i 's/bind-address.*/bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf
sudo systemctl restart mysql

# 연결 테스트
mysql -u spring_sns_user -pblackser7789 member -e "SELECT 'Connection successful!' AS result;"
